!function(){"use strict";class e{constructor(){this.eventSource=new EventSource("http://localhost:3000/sse"),this.conectionId=null,this.userList=null,this.userName=null,this.init=this.init.bind(this),this.showUsers=this.showUsers.bind(this)}init(){this.eventSource.addEventListener("message",this.showUsers)}showUsers(e){if(this.userList=JSON.parse(e.data),!this.userList.item)return void(this.conectionId=this.userList.conectionID);if(this.userList.item.deleteId){const e=document.getElementById(`${this.userList.item.deleteId}`);return void(e&&e.remove())}const t=document.querySelector("ul"),s=document.createElement("li");s.id=this.userList.item.conectionID,this.userName=this.userList.item.chatName,s.innerHTML=`\n            <div class="circle"></div>\n            <div class="name">${this.userName}</div>\n        `,t.appendChild(s),document.querySelector(".popup-container").classList.add("hidden"),document.querySelector(".btn-container").classList.remove("hidden")}}class t{constructor(){this.url="http://localhost:3000/"}async sendUserName(e,t){const s=JSON.stringify({conectionID:e,chatName:t});await fetch(`${this.url}chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:s})}async getUsers(){const e=fetch(`${this.url}`,{method:"GET",headers:{"Content-Type":"application/json"}});return(await e).text()}}class s{constructor(e,t){this.ws=new WebSocket("ws://localhost:3000/ws"),this.chat=e,this.connectionId=t,this.createMessage=this.createMessage.bind(this),this.init=this.init.bind(this),this.showMessage=this.showMessage.bind(this)}init(){this.ws.addEventListener("message",this.showMessage)}showMessage(e){const t=JSON.parse(e.data),{chat:s}=t;s.forEach((e=>{const t=this.createMessage(e.message,e.userName,e.date,e.conectionId);this.chat.appendChild(t),t.scrollIntoView()}))}sendMessage(e){this.ws.send(e)}createMessage(e,t,s,n){let i="NoName";t&&(i=t);const c=document.createElement("div");c.classList.add("message"),n!==this.connectionId?c.classList.add("participant-message"):c.classList.add("user-message");const o=document.createElement("strong");o.textContent=i;const a=document.createElement("span");a.textContent=s;const r=document.createElement("p");return r.textContent=e,c.appendChild(o),c.appendChild(a),c.appendChild(r),c}}function n(){const e=new Date;return`${String(e.getDate()).padStart(2,"0")}.${String(e.getMonth()+1).padStart(2,"0")}.${e.getFullYear()} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}(async()=>{let i;const c=new e;c.init();const o=new t,a=JSON.parse(await o.getUsers()),r=document.querySelector(".popup-container"),d=r.querySelector(".action-btn"),h=document.querySelector("ul"),u=document.getElementById("chat-window"),l=document.querySelector(".input-message"),m=document.querySelector(".send-btn");h.innerHTML="";for(const e in a){const t=document.createElement("li");t.id=e,t.innerHTML=`\n        <div class="circle"></div>\n        <div class="name">${a[e]}</div>\n    `,document.querySelector("ul").appendChild(t)}d.addEventListener("click",(e=>{e.preventDefault(),i=r.querySelector("input").value;for(const e in a)if(a[e]===i)return void document.querySelector(".error").classList.remove("hidden");o.sendUserName(c.conectionId,i)}));const p=new s(u,c.conectionId);p.init(),m.addEventListener("click",(e=>{e.preventDefault();const t=l.value;t&&(p.sendMessage(JSON.stringify({userName:i,conectionId:c.conectionId,date:n(),message:t})),l.value="")}))})()}();
//# sourceMappingURL=main.js.map